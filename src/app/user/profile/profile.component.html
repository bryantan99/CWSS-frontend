<div *ngIf="adminProfile">
  <h4>Profile</h4>
  <nz-divider></nz-divider>

  <nz-row nzJustify="start">
    <nz-col [nzXs]="24" [nzMd]="10" [nzLg]="7" [nzXl]="5" [nzXXl]="3">
      <img
        style="object-fit: cover"
        nz-image
        width="250px"
        height="250px"
        [nzSrc]="getProfilePicture(adminProfile.username, adminProfile.profilePicDirectory)"
        alt="Profile picture"
      />
    </nz-col>
    <nz-col [nzXs]="24" [nzMd]="14" [nzLg]="17" [nzXl]="19" [nzXXl]="21">
      <form nz-form [formGroup]="adminForm" *ngIf="nzEditAdmin; else displayAdminProfileTpl">
        <nz-form-item>
          <nz-form-label nzSpan="24" class="fw-bold">Name</nz-form-label>
          <nz-form-control nzSpan="12" [nzErrorTip]="fullNameErrorTpl">
            <input nz-input formControlName="fullName">
          </nz-form-control>
          <ng-template #fullNameErrorTpl let-control>
            <div *ngIf="control.invalid && (control.touched || control.dirty)">
              <div *ngIf="control.errors?.required">
                Please input your full name.
              </div>
            </div>
          </ng-template>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzSpan="24" class="fw-bold">E-mail</nz-form-label>
          <nz-form-control nzSpan="12" [nzErrorTip]="emailErrorTpl">
            <input nz-input type="email" formControlName="email" (ngModelChange)="validateEmail()">
          </nz-form-control>
          <ng-template #emailErrorTpl let-control>
            <div *ngIf="control.invalid && (control.touched || control.dirty)">
              <div *ngIf="control.errors?.required">
                Please input email!
              </div>
              <div *ngIf="control.errors?.email">
                Please input valid email!
              </div>
              <div *ngIf="control.errors?.emailTaken">
                This email has already been taken!
              </div>
            </div>
          </ng-template>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzSpan="24" class="fw-bold">Contact No</nz-form-label>
          <nz-form-control nzSpan="12" [nzErrorTip]="contactNoErrorTpl">
            <input nz-input type="text" formControlName="contactNo">
            <ng-template #contactNoErrorTpl let-control>
              <div *ngIf="control.invalid && (control.touched || control.dirty)">
                <div *ngIf="control.errors?.required">
                  Please input contact number!
                </div>
              </div>
            </ng-template>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzSpan="24" class="fw-bold">Profile Picture</nz-form-label>
          <nz-form-control nzSpan="12" [nzErrorTip]="contactNoErrorTpl">
            <nz-upload [nzLimit]="1" nzListType="picture" [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" [nzRemove]="removeFile" [nzAccept]="ACCEPTABLE_FILE_FORMAT">
              <button nz-button [disabled]="fileList.length >= 1">
                <i nz-icon nzType="upload"></i>Select {{ fileList?.length || 0 }} / 1 Image
              </button>
            </nz-upload>
            <ng-template #contactNoErrorTpl let-control>
              <div *ngIf="control.invalid && (control.touched || control.dirty)">
                <div *ngIf="control.errors?.required">
                  Please input contact number!
                </div>
              </div>
            </ng-template>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-control [nzSm]="24" [nzMd]="17">
            <nz-space>
              <button *nzSpaceItem nz-button nzType="primary"
                      [disabled]="!adminForm.valid || !adminForm.touched || !adminForm.dirty"
                      (click)="submitAdminForm()"
                      [nzLoading]="isSubmitting">Update
              </button>
              <button *nzSpaceItem nz-button nzType="default" (click)="cancelNzEdit()">Cancel</button>
            </nz-space>
          </nz-form-control>
        </nz-form-item>
      </form>

      <ng-template #displayAdminProfileTpl>
        <nz-form-item>
          <nz-form-label nzSpan="24" class="fw-bold">Name</nz-form-label>
          <nz-form-control nzSpan="24">
            <span style="white-space: normal; word-break: break-word">{{adminProfile?.fullName || "-"}}</span>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzSpan="24" class="fw-bold">E-mail</nz-form-label>
          <nz-form-control nzSpan="24">
            <span style="white-space: normal; word-break: break-word">{{adminProfile?.email || "-"}}</span>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzSpan="24" class="fw-bold">Contact No</nz-form-label>
          <nz-form-control nzSpan="24">
            {{adminProfile?.contactNo || "-"}}
          </nz-form-control>
        </nz-form-item>

        <nz-form-item *ngIf="isSuperAdmin || isOwner">
          <nz-form-control nzSpan="24">
            <nz-space>
              <button *nzSpaceItem nz-button nzType="primary" (click)="enterEditAdminMode()">Edit Profile</button>
            </nz-space>
          </nz-form-control>
        </nz-form-item>
      </ng-template>
    </nz-col>
  </nz-row>
</div>

<div *ngIf="userProfile">
  <nz-alert *ngIf="userProfile.accIsActivate !== 'Y'"
            nzType="warning"
            nzMessage="Account is not activated"
            [nzDescription]="accountNotActivatedTemplate"
            nzShowIcon
            class="mb-4">
  </nz-alert>

  <nz-page-header>
    <nz-page-header-title>{{ (userProfile?.personalDetail?.fullName | titlecase) || "-"}} Profile</nz-page-header-title>
    <nz-page-header-extra>
      <button nz-button nz-dropdown [nzDropdownMenu]="menu">
        Actions
        <i nz-icon nzType="down"></i>
      </button>
      <nz-dropdown-menu #menu="nzDropdownMenu">
        <ul nz-menu>
          <li nz-menu-item
              *ngIf="userProfile?.accIsActivate === 'Y'"
              [routerLink]="['/community-user/profile/update']"
              [queryParams]="{username: userProfile?.username}">
            Update Profile
          </li>
          <li nz-menu-item
              nz-popconfirm
              nzPopconfirmTitle="Are you sure you want to delete this user's account?"
              (nzOnConfirm)="rejectAccount(userProfile?.username)">
            Delete Account
          </li>
        </ul>
      </nz-dropdown-menu>
    </nz-page-header-extra>
  </nz-page-header>

  <nz-spin [nzSpinning]="isLoading">
    <nz-card nzTitle="Personal Detail" class="mb-4">
      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Full Name</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{(userProfile?.personalDetail?.fullName | uppercase) || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Gender</nz-col>
        <nz-col [nzXs]="24"
                [nzMd]="20">{{userProfile?.personalDetail?.gender ? (userProfile.personalDetail.gender | gender | uppercase) : '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Ethnic</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{(userProfile?.personalDetail?.ethnic | ethnic | uppercase) || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">NRIC</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.personalDetail?.nric || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Contact No.</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.personalDetail?.contactNo || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Email</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.email || '-'}}</nz-col>
      </nz-row>
    </nz-card>

    <nz-card nzTitle="Address" class="mb-4">
      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Address Line 1</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.address?.line1 || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Address Line 2</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.address?.line2 || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Postcode</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.address?.postcode || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">City</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.address?.city || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">State</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{(userProfile?.address?.state | state | uppercase) || '-'}}</nz-col>
      </nz-row>
    </nz-card>

    <nz-card nzTitle="Occupation" class="mb-4">
      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Employment Status</nz-col>
        <nz-col [nzXs]="24"
                [nzMd]="20">{{(userProfile?.occupation?.employmentType | employmentType | uppercase) || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Occupation Name</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{(userProfile?.occupation?.occupationName | uppercase) || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Salary</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">RM {{((userProfile?.occupation?.salary | number: '1.2-2')) || '0.00'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Employer Company</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.occupation?.employerCompany || '-'}}</nz-col>
      </nz-row>

      <nz-row class="mb-2">
        <nz-col class="fw-bold" [nzXs]="24" [nzMd]="4">Employer Contact No.</nz-col>
        <nz-col [nzXs]="24" [nzMd]="20">{{userProfile?.occupation?.employerContactNo || '-'}}</nz-col>
      </nz-row>
    </nz-card>

    <nz-card nzTitle="Health" class="mb-4">
      <nz-table #healthTable
                [(nzPageIndex)]="healthTablePageIndex"
                [(nzPageSize)]="healthTablePageSize"
                [nzData]="userProfile?.healthModelList"
                [nzScroll]="{x: '960px'}">
        <thead>
        <tr>
          <th nzWidth="80px">No.</th>
          <th nzWidth="150px">Disease Name</th>
          <th nzWidth="500px">Description</th>
          <th nzWidth="120px">Validation Status</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let data of healthTable.data; let i = index">
          <td>{{(healthTablePageIndex - 1) * healthTablePageSize + i + 1}}</td>
          <td>{{data?.diseaseName || '-'}}</td>
          <td>{{data?.diseaseDescription || '-'}}</td>
          <td>
            <nz-tag [nzColor]="'green'" *ngIf="data?.approvedBy && data?.approvedDate" nz-popover
                    [nzPopoverContent]="validatedContentTpl">Validated
            </nz-tag>
            <nz-tag [nzColor]="'gold'" *ngIf="!(data?.approvedBy && data?.approvedDate)">Pending</nz-tag>
            <ng-template #validatedContentTpl>
              Validated by {{data?.approvedBy | titlecase}} on {{(data?.approvedDate | date: DATE_FORMAT) || '-'}}
            </ng-template>
          </td>
        </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </nz-spin>
</div>

<ng-template #accountNotActivatedTemplate>
  <p nz-typography>Account details are provided by the user and has not been verified.<br> Please verify the details
    before approving the account.</p>
  <button nz-button nzType="primary" class="me-2 mb-2" (click)="approveAccount(userProfile?.personalDetail?.username)">
    Approve
  </button>
  <button nz-button nzDanger nzType="primary" (click)="rejectAccount(userProfile?.personalDetail?.username)">Reject
  </button>
</ng-template>
